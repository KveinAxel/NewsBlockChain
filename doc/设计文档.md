# NewsBlockChain 设计文档

## 环境

生产环境：Microsoft Windows10 [ 兼容全平台 ]

开发环境：Microsoft Windows10、Manjaro (Linux Kernel 5.4)

运行环境：Desktop Qt 5.14.1 MinGW 64-bit; LevelDB 1.22; QtWebApp

## 系统架构

![System Structure](C:\Users\Kevin\Desktop\NewsBlockChain\doc\System Structure.png)

## 模块概述

本项目大致可以分为本地前端，DNS服务器，区块节点服务器三个模块。

### 本地前端

本地前端主要负责用户交互和数据渲染任务，通过向本地的区块节点服务器请求资源并渲染。

具体包括以下功能：

**最新区块展示**。用户可查看最新区块信息，包括压缩前信息与压缩后信息。

**按区块号查找区块**。用户输入区块号，快速查找到该区块，查找后能进行查看区块信息、篡改检测等操作。

**发布区块**。用户提供数据，并发布区块，返回区块哈希。

**查看信息**。在用户选择区块后，可以选择查看区块的简要信息或详细信息。

**篡改检测**。在用户选择区块后，用户输入要检测的新闻的具体内容（格式与发布区块时的格式相同），展示被篡改的区块的段落号与内容。

**关键词查找**。用户可以给定一组关键词（不少于三个）后，查找并展示这一组关键词出现的累计频次最高的三篇文章（按频次降序给出）。

### DNS服务器

DNS服务器为硬编码服务器，用于给有意愿加入区块P2P网络的节点提供超级节点的IP，也支持区块主动成为超级节点，DNS服务器只负责维护超级节点的ip和超级节点携带的边缘节点数。具体功能如下：

**成为边缘节点**。用户输入自己的IP地址，向DNS服务器发送成为边缘节点的请求，DNS服务器选择负载量最低的超级节点，向其发送建立新边缘节点的请求（包含新节点的IP地址），更新其负载边缘节点数，并向新节点返回超级节点的IP地址。

**成为超级节点**。用户输入自己的IP地址，向DNS服务器发送成为超级节点的请求，DNS核实后，将该IP加入超级节点字典，并维护其负载边缘节点数。

**广播区块**。当一个超级节点获得广播时，向DNS请求并将区块广播到其他节点。

### 区块节点服务器

区块节点服务器则完成区块链的主体功能，包括请求区块数据，被请求区块数据，发布新区块。也包括一切业务功能，如篡改检测，关键词查找。具体功能如下：

**向请求更新区块**。边缘节点向超级节点发送更新请求，超级节点负责返回整套区块，边缘节点检测返回的区块是否合法，若合法则将新区块合并到本地。超级节点则向附近超级节点请求更新。原则上本功能是为长时间未在线节点准备，否则所有在线节点将在广播发动后全体更新至最新情况。

**向区块链广播区块**。边缘节点向超级节点推送最新区块信息，超级节点核实后向相邻超级节点和所负载边缘节点推送区块信息。

**向本地磁盘写入区块信息**。采用LevelDB，将区块头哈希和整个区块作为键值对存入数据库中。

**整套区块链的数据结构**。

**按关键词查找区块。**

**篡改检测**。

**哈希算法。**



